<%- include ../header %>
<div class="tm-middle">
    <div class="uk-container uk-container-center uk-margin-top uk-margin-bottom">
    	<div class="uk-width-medium-5-6 uk-container-center">
            <div class="uk-grid" data-uk-grid-margin>
                <div class="uk-width-large-3-4">
                    <div class="panel panel_border mb10">
                        <div class="uk-panel uk-panel-header pd5">
                            <div class="uk-panel-title pd10">
                                <div class="uk-form">
                                    <div class="uk-grid">
                                        <div class="uk-width-3-5 uk-form-icon">
                                            <i class="uk-icon-file-text-o"></i>
                                            <input type="text" placeholder="" class="uk-width-1-1" id="topic_title">
                                        </div>
                                        <div class="uk-width-2-5 uk-form-icon">
                                            <select class="uk-width-1-1" id="topic_tag">
                                                <option value="xq">心情</option>
                                                <option value="js">技术</option>
                                                <option value="fx">分享</option>
                                                <option value="qz">求助</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="topic_box">
                                <div class="topic_content uk-form">
                                    <div class="uk-form-row">
                                        <textarea class='editor' name='t_content' rows='4'
                                        ></textarea>

                                    </div>

                                </div>
                                <div class="uk-clearfix">
                                    <div class="uk-float-right">
                                        <a href="###" class="uk-button" id="eyeBtn"><i class="uk-icon-eye">&nbsp;公开</i></a>
                                        <a href="###" class="uk-button uk-button-success uk-vertical-align-middle" id="createTopic"><i class="uk-icon-location-arrow"></i>&nbsp;我要发帖</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="uk-width-large-1-4 uk-hidden-small">
                    <div class="panel mb10 panel_border">
                        <div class="uk-panel uk-panel-header pd5">
                            <h3 class="uk-panel-title">Markdown 语法参考</h3>
                            ### 单行的标题<br />
                            **粗体**<br />
                            `console.log('行内代码')`<br />
                            ```js\n code \n``` 标记代码块<br />
                            [内容](链接)<br />
                            ![文字说明](图片链接)<br />
                        </div>
                    </div>
                    <%- include ../goHome %>
                    <%- include ../works %>
                    <%- include ../tool %>
                    <%- include ../friendship %>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include ../footer %>
<link rel="stylesheet" href="/css/editor.css" />
<script type="text/javascript" src="/js/editor.js"></script>
<script type="text/javascript" src="/js/marked.js"></script>
<script type="text/javascript">
(function(){
    var editor = new Editor();
    editor.render($('.editor')[0]);
    //发帖
    var title, content, tag;
    var isOpen = 1;
    $('#createTopic').click(function(){
        title = $('#topic_title').val();
        content = editor.constructor.markdown(editor.codemirror.getValue());
        tag = $('#topic_tag').val();
        if('' == $.trim(title)){
            $.UIkit.notify('请输入标题', {pos:'top-right',status:'danger',timeout: 1000});
            return;   
        }
        if('' == $.trim(content)){
            $.UIkit.notify('请不要发空内容的帖子', {pos:'top-right',status:'danger',timeout: 1000});
            return;   
        }
        $.ajax({
            type: 'POST',
            url: '/topic/create',
            data: {title : title, content : content, tag : tag,isOpen : isOpen},
            success: function(result){
                if(0 == result.status){
                    $.UIkit.notify(result.content, {pos:'top-right',status:'success',timeout: 1000});
                    setTimeout('window.location.href = "/"',1000);
                }else{
                    $.UIkit.notify(result.content, {pos:'top-right',status:'danger',timeout: 1000});
                }
            }
        });
    });
    $('#eyeBtn').click(function(){
        if ($(this).hasClass('uk-button-primary')){
            $('#eyeBtn').removeClass('uk-button-primary').html('<i class="uk-icon-eye">&nbsp;公开</i>');
            isOpen = 1;
        }else{
            $('#eyeBtn').addClass('uk-button-primary').html('<i class="uk-icon-eye-slash">&nbsp;私人</i>');
            isOpen = 0;
        }
        
        
    });
})();
</script>